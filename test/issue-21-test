#!/bin/bash

# Test for GitHub issue #21.
# See: https://github.com/allenh1/YaSh/issues/21

# this is the command that broke it.
cd_cmd="cd .././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/./././././././././././././././././././././././././././././././././././././././././././././.././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/./././././././././././././././././././././././././././././././././././././././././././././.././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/./././././././././././././././././././././././././././././././././././././././././././././.././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././././/./././././././././././././././././././././././././././././././././././././././././././././"

echo "cd ../../" >> simple_cd
echo "pwd" >> simple_cd

echo cd_cmd >> shane_cd
echo "pwd" >> shane_cd

../src/yash < simple_cd &>> simple_out
../src/yash < shane_cd &>> shane_out

diff simple_out shane_out

if [[ $? -ne 0 ]]; then
    echo "Issue #21 regression test failed"
    rm -f simple_out shane_out
    exit 1
fi

echo "Issue 21 test OK"
rm -f simple_out shane_out
exit 0
